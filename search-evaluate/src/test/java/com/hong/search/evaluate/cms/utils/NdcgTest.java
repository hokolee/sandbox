package com.hong.search.evaluate.cms.utils;

import com.alibaba.fastjson.JSONArray;
import com.alibaba.fastjson.JSONObject;
import org.junit.Test;

import java.util.Arrays;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

/**
 * Created by hong on 15-12-19.
 */
public class NdcgTest {
    private static final String searchResult = "[[{\"group_name\":\"应用商店\",\"items\":[{\"data\":[{\"action_url\":{\"min_version\":0,\"package\":\"com.xiaomi.market\",\"style\":\"text\",\"text\":\"安装\",\"url\":\"market://details?id=com.baidu.searchbox&startDownload=true&ref=com.android.quicksearchbox\"},\"detail_url\":{\"min_version\":0,\"package\":\"com.xiaomi.market\",\"style\":\"text\",\"text\":\"详情\",\"url\":\"market://details?id=com.baidu.searchbox&startDownload=false&ref=com.android.quicksearchbox\"},\"doc_type\":\"app\",\"id\":318,\"image\":\"http://file.market.xiaomi.com/thumbnail/WEBP/l153/AppStore/083b24aa1e5a998f35c26c380615ce99473406c86\",\"image_fit\":\"center_crop\",\"package\":\"com.xiaomi.market\",\"package_name\":\"com.baidu.searchbox\",\"score\":3,\"subtitle\":\"实用 | 30.2 MB\",\"title\":\"手机百度\",\"url\":{\"min_version\":0,\"package\":\"com.android.browser\",\"text\":\"详情\",\"url\":\"http://app.mi.com/detail/318\"}}],\"style\":\"        icon_3line\"},{\"data\":[{\"action_url\":{\"min_version\":0,\"package\":\"com.xiaomi.market\",\"style\":\"text\",\"text\":\"安装\",\"url\":\"market://details?id=com.baidu.netdisk&startDownload=true&ref=com.android.quicksearchbox\"},\"detail_url\":{\"min_version\":0,\"package\":\"com.xiaomi.market\",\"style\":\"text\",\"text\":\"详情\",\"url\":\"market://details?id=com.baidu.netdisk&startDownload=false&ref=com.android.quicksearchbox\"},\"doc_type\":\"app\",\"id\":5314,\"image\":\"http://file.market.xiaomi.com/thumbnail/WEBP/l153/AppStore/06ba555b1da316bcf490dabad5ead8b56a2434cf9\",\"image_fit\":\"center_crop\",\"package\":\"com.xiaomi.market\",\"package_name\":\"com.baidu.netdisk\",\"score\":2,\"subtitle\":\"实用 | 12.9 MB\",\"title\":\"百度云\",\"url\":{\"min_version\":0,\"package\":\"com.android.browser\",\"text\":\"详情\",\"url\":\"http://app.mi.com/detail/5314\"}}],\"style\":\"icon_3line\"}],\"package\":\"com.xiaomi.market\",\"type\":\"app\"},{\"group_name\":\"生活服务\",\"items\":[{\"data\":[{\"action_url\":{\"min_version\":0,\"package\":\"com.android.contacts\",\"style\":\"dial\",\"text\":\"拨号\",\"url\":\"tel:01059928888\"},\"detail_url\":{\"min_vers  ion\":0,\"package\":\"com.miui.yellowpage\",\"style\":\"text\",\"text\":\"查看\",\"url\":\"yellowpage://details?sid=643123\"},\"doc_type\":\"normal\",\"id\":643123,\"image\":\"http://file.market.xiaomi.com/thumbnail/PNG/l118/FoundApp/7402da8a-ad9d-4370-beee-f049c0efa81b\",\"image_fit\":\"center_crop\",\"package\":\"com.miui.yellowpage\",\"subtitle\":\"总机 01059928888\",\"title\":\"百度\"}],\"style\":\"icon_2line\"},{\"data\":[{\"action_url\":{\"min_version\":0,\"package\":\"com.android.contacts\",\"style\":\"dial\",\"text\":\"拨号\",\"url\":\"tel:4000998998\"},\"detail_url\":{\"min_version\":0,\"package\":\"com.miui.yellowpage\",\"style\":\"text\",\"text\":\"查看\",\"url\":\"yellowpage://details?sid=7731193\"},\"doc_type\":\"normal\",\"id\":7731193,\"image\":\"http://file.market.xiaomi.com/thumbnail/PNG/l118/FoundApp/0ffd0f4538e9d4660004bf20734145d611013849f\",\"image_fit\":\"center_crop\",\"package\":\"com.miui.yellowpage\",\"subtitle\":\"客户服务中心 4000998998\",\"title\":\"百度地图\"}],\"style\":\"icon_2line\"},{\"data\":[{\"action_url\":{\"min_version\":0,\"package\":\"com.android.contacts\",\"style\":\"dial\",\"text\":\"拨号\",\"url\":\"tel:4008008888\"},\"detail_url\":{\"min_version\":0,\"package\":\"com.miui.yellowpage\",\"style\":\"text\",\"text\":\"查看\",\"url\":\"yellowpage://details?sid=7\"},\"doc_type\":\"normal\",\"id\":7,\"image\":\"http://file.market.xiaomi.com/thumbnail/PNG/l118/970/6c3a05758099aee339e9cada989b9ede74cb8ff3\",\"image_fit\":\"center_crop\",\"package\":\"com.miui.yellowpage\",\"subtitle\":\"咨询电话 4008008888\",\"title\":\"百度推广\"}],\"style\":\"icon_2line\"}],\"package\":\"com.miui.yellowpage\",\"type\":\"yellow\"},{\"group_name\":\"新闻\",\"items\":[{\"data\":[{\"detail_url\":{\"min_version\":69,\"package\":\"com.yidian.xiaomi\",\"style\":\"text\",\"text\":\"详情\",\"url\":\"yidian://open_news?docid=0BiuKze3&s=misearch\"},\"id\":\"0BiuKze3\",\"image\":\"http://i3.go2yd.com/image.php?url=0BiuKz00&type=_242x175\",\"image_fit\":\"center_crop\",\"package\":\"com.yidian.xiaomi\",\"subtitle\":\"3小时前 | IT专家网\",\"title\":\"李彦宏：百度时刻准备着回国上市\",\"url\":{\"min_version\":0,\"package\":\"com.android.browser\",\"text\":\"浏览\",\"url\":\"http://www.yidianzixun.com/n/0BiuKze3?s=misearch\"}}],\"style\":\"cover_2line\"},{\"data\":[{\"detail_url\":{\"min_version\":69,\"package\":\"com.yidian.xiaomi\",\"style\":\"text\",\"text\":\"详情\",\"url\":\"yidian://open_news?docid=0Birksbf&s=misearch\"},\"id\":\"0Birksbf\",\"image\":\"http://i3.go2yd.com/image.php?url=0Birks00&type=_242x175\",\"image_fit\":\"center_crop\",\"package\":\"com.yidian.xiaomi\",\"subtitle\":\"3小时前 | IT168\",\"title\":\"百度视频APP荣获\\\"易观之星TOP APP\\\"大奖\",\"url\":{\"min_version\":0,\"package\":\"com.android.browser\",\"text\":\"浏览\",\"url\":\"http://www.yidianzixun.com/n/0Birksbf?s=misearch\"}}],\"style\":\"cover_2line\"},{\"data\":[{\"detail_url\":{\"min_version\":69,\"package\":\"com.yidian.xiaomi\",\"style\":\"text\",\"text\":\"详情\",\"url\":\"yidian://open_news?docid=0BipzRVH&s=misearch\"},\"id\":\"0BipzRVH\",\"image\":\"http://i3.go2yd.com/image.php?url=0BipzR00&type=_242x175\",\"image_fit\":\"center_crop\",\"package\":\"com.yidian.xiaomi\",\"subtitle\":\"4小时前 | 中国B2B研究中心\",\"title\":\"宜人贷赴美上市 百度成为其“基石投资者”\",\"url\":{\"min_version\":0,\"package\":\"com.android.browser\",\"text\":\"浏览                            \",\"url\":\"http://www.yidianzixun.com/n/0BipzRVH?s=misearch\"}}],\"style\":\"cover_2line\"}],\"package\":\"com.yidian.xiaomi\",\"type\":\"news\"},{\"group_name\":\"视频\",\"items\":[{\"data\":[{\"detail_url\":{\"min_version\":2015051790,\"package\":\"com.miui.video\",\"style\":\"text\",\"text\":\"详情\",\"url\":\"mivideo://video/detail?id=V000007054\"},\"doc_type\":\"video\",\"id\":\"V000007054\",\"image\":\"http://image.box.xiaomi.com/mfsv2/download/s010/p01ZOfGUzl9z/DwXZGO3PhzkJiJ.jpg!s\",\"image_fit\":\"center_crop\",\"label\":[{\"icon\":\"play\",\"loc\":\"center\",\"target\":\"image\"}],\"package\":\"com.miui.video\",\"score\":4.5,\"title\":\"百度世界大会2012\"},{\"detail_url\":{\"min_version\":2015051790,\"package\":\"com.miui.video\",\"style\":\"text\",\"text\":\"详情\",\"url\":\"mivideo://video/detail?id=V000006483\"},\"doc_type\":\"video\",\"id\":\"V000006483\",\"image\":\"http://image.box.xiaomi.com/mfsv2/download/s010/p01uAmxt11nS/kQ5dwjEwZ7USlA.jpg!s\",\"image_fit\":\"center_crop\",\"label\":[{\"icon\":\"play\",\"loc\":\"center\",\"target\":\"image\"}],\"package\":\"com.miui.video\",\"score\":4.449999809265137,\"title\":\"百度世界大会2013\"},{\"detail_url\":      {\"min_version\":2015051790,\"package\":\"com.miui.video\",\"style\":\"text\",\"text\":\"详情\",\"url\":\"mivideo://video/detail?id=V000007848\"},\"doc_type\":\"video\",\"id\":\"V000007848\",\"image\":\"http://image.box.xiaomi.com/mfsv2/download/s010/p01Yh06Qy962/CbB5o3y7idwALf.jpg!s\",\"image_fit\":\"center_crop\",\"label\":[{\"icon\":\"play\",\"loc\":\"center\",\"target\":\"image\"}],\"package\":\"com.miui.video\",\"score\":4.199999809265137,\"title\":\"百度世界大会2011\"}],\"style\":\"poster_3gallery\"}],\"more\":{\"package\":\"com.miui.video\",\"text\":\"搜索更多视频\",\"url\":\"mivideo://video/search?id=百度\"},\"package\":\"com.miui.video\",\"type\":\"video\"},{\"group_name\":\"音乐\",\"items\":[{\"data\":[{\"action_url\":{\"min_version\":0,\"package\":\"com.miui.player\",\"style\":\"play\",\"text\":\"播放\",\"url\":\"miui-music://play/song/6091719\"},\"detail_url\":{\"min_version\":0,\"package\":\"com.miui.player\",\"style\":\"text\",\"text\":\"详情\",\"url\":\"miui-music://view/song/6091719\"},\"doc_type\":\"song\",\"id\":6091719,\"image\":\"http://b.hiphotos.baidu.com/ting/s%3D500/sign=d36242336e224f4a5399731339f69044/5243fbf2b2119313d1e7cba566380cd791238d7a.jpg\",\"image_fit\":\"center_crop\",\"package\":\"com.miui.player\",\"subtitle\":\"小雨哥\",\"title\":\"百度贴吧\",\"url\":{\"min_version\":-1,\"package\":\"com.android.browser\",\"style\":\"text\",\"text\":\"播放\",\"url\":\"http://app.fm.duokanbox.com/service?songIds=%5B6091719%5D&start=0&type=-1&play=1#ref=global_search\"}}],\"style\":\"text_2line\"},{\"data\":[{\"action_url\":{\"min_version\":0,\"package\":\"com.miui.player\",\"style\":\"play\",\"text\":\"播放\",\"url\":\"miui-music://play/song/6259744\"},\"detail_url\":{\"min_version\":0,\"package\":\"com.miui.player\",\"style\":\"text\",\"text\":\"详情\",\"url\":\"miui-music://view/song/6259744\"},\"doc_type\":\"song\",\"id\":6259744,\"image\":\"http://image.box.xiaomi.com/mfsv2/download/s010/p019ov37KVz5/vZ9gH4Yk9eiSO9.jpg!ss\",\"image_fit\":\"center_crop\",\"package\":\"com.miui.player\",\"subtitle\":\"张旭分享\",\"title\":\"百度贴吧\",\"url\":{\"min_version        \":-1,\"package\":\"com.android.browser\",\"style\":\"text\",\"text\":\"播放\",\"url\":\"http://app.fm.duokanbox.com/service?songIds=%5B6259744%5D&start=0&type=-1&play=1#ref=global_search\"}}],\"style\":\"text_2line\"},{\"data\":[{\"action_url\":{\"min_version\":0,\"package\":\"com.miui.player\",\"style\":\"play\",\"text\":\"播放\",\"url\":\"miui-music://play/song/755539\"},\"detail_url\":{\"min_version\":0,\"package\":\"com.miui.player\",\"style\":\"text\",\"text\":\"详情\",\"url\":\"miui-music://view/song/755539\"},\"doc_type\":\"song\",\"id\":755539,\"image\":\"http://image.box.xiaomi.com/mfsv2/download/s010/p01z5DmNJOdm/I3A8jzz2GxCOFC.jpg!ss\",\"image_fit\":\"center_crop\",\"package\":\"com.miui.player\",\"subtitle\":\"阿龙正罡 | 遍体鳞伤\",\"title\":\"百度我的爱\",\"url\":{\"min_version\":-1,\"package\":\"com.android.browser\",\"style\":\"text\",\"text\":\"播放\",\"url\":\"http://app.fm.duokanbox.com/service?songIds=%5B755539%5D&start=0&type=-1&play=1#ref=global_search\"}}],\"style\":\"text_2line\"}],\"more\":{\"package\":\"com.miui.player\",\"text\":\"搜索更多音乐\",\"url\":\"miui-music://search?q=百度\"},\"package\":\"com.miui.player\",\"type\":\"music\"},{\"group        _name\":\"网址\",\"items\":[{\"data\":[{\"id\":\"db9f7d9c6f77817aef434095108d3b2bed25947a\",\"image\":\"\",\"image_fit\":\"center_crop\",\"package\":\"com.android.browser\",\"subtitle\":\"http://m.baidu.com\",\"title\":\"百度\",\"url\":{\"min_version\":0,\"package\":\"com.android.browser\",\"text\":\"浏览\",\"url\":\"http://m.baidu.com\"}}],\"style\":\"text_2line\"},{\"data\":[{\"id\":\"4c01c7f38615b9fc35fd64946e1047155488b1bd\",\"image\":\"http://image.baidu.com/favicon.ico\",\"image_fit\":\"center_crop\",\"package\":\"com.android.browser\",\"subtitle\":\"http://image.baidu.com\",\"title\":\"百度图片\",\"url\":{\"min_version\":0,\"package\":\"com.android.browser\",\"text\":\"浏览\",\"url\":\"http://image.baidu.com\"}}],\"style\":\"text_2line\"},{\"data\":[{\"id\":\"bce75f222a15a326d950ad858de1715986822da8\",\"image\":\"http://tb1.bdstatic.com/tb/favicon.ico\",\"image_fit\":\"center_crop\",\"package\":\"com.android.browser\",\"subtitle\":\"http://tieba.baidu.com\",\"title\":\"百度贴吧\",\"url\":{\"min_version\":0,\"package\":\"com.android.browser\",\"text\":\"浏览\",\"url\":\"http://tieba.baidu.com\"}}],\"style\":\"text_2line\"}],\"package\":\"com.android.browser\",\"type\":\"website\"},{\"group_name\":\"阅读\",\"items\":[{\"data\":[{\"detail_url\":{\"min_version\":0,\"package\":\"com.duokan.reader\",\"style\":\"text\",\"text\":\"阅读\",\"url\":\"duokan-reader://store/book/76a6d02b0c2c453cbd6c5f747e394c3a\"},\"doc_type\":\"book\",\"id\":\"76a6d02b0c2c453cbd6c5f747e394c3a\",\"image\":\"http://cover.read.duokan.com/mfsv2/download/s010/p01fMz8QoVLu/skPid7kOn9emAI.jpg!s\",\"image_fit\":\"center_crop\",\"package\":\"com.duokan.reader\",\"score\":3.665,\"subtitle\":\"周艳国\",\"title\":\"百度创业内幕\",\"url\":{\"min_version\":0,\"package\":\"com.android.browser\",\"text\":\"阅读\",\"url\":\"http://www.duokan.com/m/book/73147\"}},{\"detail_url\":{\"min_version\":0,\"package\":\"com.duokan.reader\",\"style\":\"text\",\"text\":\"阅读\",\"url\":\"duokan-reader://store/book/9f309421991a43de89f6596fc4bc81c9\"},\"doc_type\":\"book\",\"id\":\"9f309421991a43de89f6596fc4bc81c9\",\"image\":\"http://cover.read.duokan.com/mfsv2/download/s010/p01VRtsJps2q/mYB2lvAuBzYpi9.jpg!s\",\"image_fit\":\"center_crop\",\"package\":\"com.duokan.reader\",\"score\":4,\"subtitle\":\"何许人\",\"title\":\"百度贴吧X事件\",\"url\":{\"min_version\":0,\"package\":\"com.android.browser\",\"text\":\"阅读\",\"url\":\"http://www.duokan.com/m/book/97459\"}},{\"detail_url\":{\"min_version\":0,\"package\":\"com.duokan.reader\",\"style\":\"text\",\"text\":\"阅读\",\"url\":\"duokan-reader://store/book/bf7e5c395ab4461d8aaba303b463d274\"},\"doc_type\":\"book\",\"id\":\"bf7e5c395ab4461d8aaba303b463d274\",\"image\":\"http://cover.read.duokan.com/mfsv2/download/s010/p01JqUm0t23C/i6XYj8saFkWxbj.jpg!s\",\"image_fit\":\"center_crop\",\"package\":\"com.duokan.reader\",\"score\":3.665,\"subtitle\":\"程东升\",\"title\":\"李彦宏的百度世界\",\"url\":{\"min_version\":0,\"package\":\"com.android.browser\",\"text\":\"阅读\",\"url\":\"http://www.duokan.com/m/book/33747\"}}],\"style\":\"poster_3gallery\"}],\"more\":{\"package\":\"com.duokan.reader\",\"text\":\"搜索更多书籍\",\"url\":\"duokan-reader://store/search?key=百度\"},\"package\":\"com.duokan.reader\",\"type\":\"book\"}]]";

    @Test
    public void scoreTest() {
        Ndcg ndcg = new Ndcg();
        Map<String, JSONObject> choice = new HashMap<>();
        JSONObject jsonObject = new JSONObject();
        jsonObject.put("0BiXEfAg", 1);
        jsonObject.put("0BiSbqWp", 2);
        jsonObject.put("0BiRNklW", 0);
        choice.put("test", jsonObject);
        Map<String, JSONArray> data = new HashMap<>();
        data.put("test", new JSONArray(JSONArray.parseArray(searchResult)));
        System.out.println(ndcg.score(choice, data));
    }

    @Test
    public void ndcgTest() {
        List<Integer> rank = Arrays.asList(3, 2, 3, 0, 1, 2);
        Ndcg ndcg = new Ndcg();
        System.out.println(ndcg.computedcg(rank)/ndcg.computeIDCG(rank));
    }

}
